sudo: false
language: clojure
lein: 2.8.1
jdk:
  - oraclejdk8
  - oraclejdk9
  - oraclejdk10
  - oraclejdk11

env:
  global:
    # Encrypted OC_TOKEN for deploying to OpenShift
    - secure: "n9e3ipL2YwIyV3h0b/KbeVoO9AP4LxTmiVQPut2TD0b/ZJq+IDEobB05Zg1qYDxZ7vAiMNiwuDd8cGv7gPZMwcImZxfC46Nol3ilY9orFmt/ctXT1irn6JpzduBDNr4bduxDRNuAeKGowPDQoV3eAec+/uATxyT8fv9sf+w4XxNBgrZELP8fJlAJMGv3hI8i9pr477tC7YAZWH2UYrVbhkwviUl+qzSmEoFsW3gLRi/wgZqOGPdnZF5MEer6mWG8IDM389xLjI1Po/EVYxyhpwvhOzs085O6QQMCBAHrfRs0yeozWru4iSc1gIgzS/kTm82k3vVrA1NgHTUKiOp1Qkj9wSt/aaDNu1Q/QCofcW5Zrjj7zSnnKhPtNwkT5tixn5SzjqVSadMMJrSWLF+jN6mS6xXn4M3ypqfM4vlfnc7ckAJfqc3tdpEXuI00K5YGNWKG3BP82LjLY8h7hBhKymZwBpKc8Ev3SrGYoJYRp3GXvxWsOehXnEKup+Rrl2YVddOctI9VQsw3Ab33VWO4kfMb2migoDFdj19EhA93gOqGCyKDtUtsKD5qGPuJOvtNfKVaCNo+4kdfTSBlZp6OPe1Y5z/UQ3RHKt/Oww16dNpy0CcYSWWiZNnSvAesynBNvdDXZZ+VQUkC/7LwRMB0lgEHQWsG0YnyRRH/1FSOiuk="
    # Encrypted WHITESOURCE_TOKEN for updating Whitesource licensing information
    - secure: "JHNP7dcBM2zHuhxI0EYcAggGbQn1Q4AwvcTcsfFl0WX94L9ki73YZNfnvTqCEzVzitWAIfK3hASYrwF4RHjNaEl/9T4rh4kY9S9B9yERjsvaoEowFdrhgprz13TBFnZZuxPcXJ05/8i25W+vfRKBM6coF8T+NfbyTqCW1ACE0rNhq8/FiFp5ldL0/IYpBuhSPBENgz2XaSJL+Rjmw2WA1Ucu2he6D3a7XUe/kCDZVAuq9D11USvglxUYQQTRkvaQddHqoqtnPDDnkwP/YrVMusTioSgYctZP2QWaEKhKzzSPyCdTw0VP6t1E0t8Gq46eqhU0L4eD5xpngLpIrG8238A3bqKGGIILc0UgKCE2/IWTGghEarRRSClr0vaAQKpXApYK8/yBzHjM62dPpBJ2LttvFdzRLQeBE7ZX6fabRqIQRBoAt7isZEDq84/+9wUjCKsjjDQqjFut3ESOHQ7D9RdKvY6RUZ4Hc1Y+o6GAchZGopWbGBWA67wr69zByiDc8WhH1e3sH1mn8z2WAQwEZcVF/F/+krb2NuniYAlP8IGNOGZi+sb7/NF+1jE6TnSV7aRTaMC0sltjLmFbdMyiqSpjJsPS3WR4Z8+aauq1N7i2DKPOt9PDANFku1CoFfGkpQZ+77KgSlClM7Zf+Tykd4unrLrFgE7I1cXeIxq4dgk="

script: lein do git-info-edn, version, check

deploy:
  # Deploy binaries to OpenShift
  - provider: script
    skip_cleanup: true
    script: lein do git-info-edn, uberjar && mkdir -p target/oc && cp target/*-standalone.jar target/oc/ && ./deploy-to-openshift.sh $TRAVIS_BRANCH $TRAVIS_PULL_REQUEST
    on:
      all_branches: true
      jdk: oraclejdk11
  # Update Whitesource
  - provider: script
    skip_cleanup: true
    script: lein pom && mvn org.whitesource:whitesource\-maven\-plugin:18.6.2:update -Dorg.whitesource.orgToken=$WHITESOURCE_TOKEN -Dorg.whitesource.ignoredScopes=test,runtime,provided,system
    on:
      branch: master
      jdk: oraclejdk11
